(()=>{"use strict";var e={9231:(e,t,a)=>{a.r(t),a.d(t,{AuthContext:()=>U,auth:()=>$,db:()=>H,default:()=>V});var r=a(7225),n=a(3668),o=a(3929),s=a(530),i=a(6520),l=a(6775),d=a(7908),c=a(6888),u=a(6665),f=a(6283),g=a(6773),m=a(5648),h=a(6933),y=a(4701),p=a(5991),x=a(3305),b=a(9468),w=a(3715),j=a(8891),S=a(397);function C({navigation:e}){const[t,r]=(0,u.useState)(""),[n,s]=(0,u.useState)(""),[i,l]=(0,u.useState)(!1),[d,C]=(0,u.useState)(!1),[v,I]=(0,u.useState)(""),F=async()=>{try{const{status:e}=await b.requestForegroundPermissionsAsync();if("granted"!==e)return null;const t=await b.getCurrentPositionAsync({});return{latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy,timestamp:(new Date).toISOString()}}catch(v){return console.error("Location error:",v),null}},k=async()=>({brand:j.brand||"unknown",modelName:j.modelName||"unknown",osName:j.osName||"web",osVersion:j.osVersion||p.default.Version,platform:"web"});return(0,S.jsx)(y.default,{style:T.safeArea,children:(0,S.jsx)(h.default,{source:a(9976),style:T.container,resizeMode:"cover",defaultSource:a(9976),children:(0,S.jsxs)(o.default,{style:T.overlay,children:[(0,S.jsx)(f.default,{style:T.appName,children:"Vault"}),(0,S.jsx)(f.default,{style:T.title,children:"Welcome Back"}),(0,S.jsxs)(o.default,{style:T.inputContainer,children:[(0,S.jsx)(x.default,{name:"mail-outline",size:24,color:"#666",style:T.inputIcon}),(0,S.jsx)(g.default,{style:T.input,placeholder:"Email",value:t,onChangeText:r,autoCapitalize:"none",keyboardType:"email-address"})]}),(0,S.jsxs)(o.default,{style:T.inputContainer,children:[(0,S.jsx)(x.default,{name:"lock-closed-outline",size:24,color:"#666",style:T.inputIcon}),(0,S.jsx)(g.default,{style:T.input,placeholder:"Password",value:n,onChangeText:s,secureTextEntry:!i}),(0,S.jsx)(m.default,{style:T.eyeIcon,onPress:()=>l(!i),children:(0,S.jsx)(x.default,{name:i?"eye-off":"eye",size:24,color:"#666"})})]}),v?(0,S.jsx)(f.default,{style:T.errorText,children:v}):null,(0,S.jsx)(m.default,{style:[T.button,d&&T.buttonDisabled],onPress:async()=>{if(t.trim()&&n.trim())try{C(!0),I("");const e=(await(0,c.signInWithEmailAndPassword)($,t,n)).user,[a,r]=await Promise.all([F(),k()]);if(await(0,w.setDoc)((0,w.doc)(H,"users",e.uid),{lastLogin:(0,w.serverTimestamp)(),lastSeen:(0,w.serverTimestamp)(),location:a||{latitude:0,longitude:0},deviceInfo:r},{merge:!0}),a){const t=(new Date).toISOString();await(0,w.setDoc)((0,w.doc)(H,`users/${e.uid}/locationHistory/${t}`),Object.assign({},a,{type:"login",timestamp:(0,w.serverTimestamp)()}))}}catch(v){let t="Invalid email or password";"auth/user-not-found"===v.code||"auth/wrong-password"===v.code?t="Invalid email or password":"auth/invalid-email"===v.code?t="Invalid email address":"auth/too-many-requests"===v.code&&(t="Too many attempts. Please try again later"),I(t)}finally{C(!1)}else I("Email and password are required")},disabled:d,children:(0,S.jsx)(f.default,{style:T.buttonText,children:d?"Logging in...":"Login"})}),(0,S.jsx)(m.default,{style:T.secondaryButton,onPress:()=>e.navigate("SignUp"),children:(0,S.jsxs)(f.default,{style:T.secondaryButtonText,children:["Don't have an account? ",(0,S.jsx)(f.default,{style:T.boldText,children:"Sign Up"})]})})]})})})}const T=n.default.create({safeArea:{flex:1,backgroundColor:"#000"},container:{flex:1,width:"100%",height:"100%",backgroundColor:"#1a1a1a"},overlay:{flex:1,backgroundColor:"rgba(0, 0, 0, 0.3)",alignItems:"center",justifyContent:"center",padding:20},appName:{fontSize:42,fontWeight:"bold",color:"#FFFFFF",marginBottom:10,letterSpacing:2},title:{fontSize:24,fontWeight:"600",color:"#FFFFFF",marginBottom:40},inputContainer:{width:"100%",flexDirection:"row",alignItems:"center",borderWidth:1,borderColor:"#ddd",borderRadius:10,marginBottom:15,backgroundColor:"#fff"},input:{flex:1,height:50,paddingHorizontal:15,fontSize:16},inputIcon:{paddingLeft:15},button:{backgroundColor:"#333",width:"100%",padding:15,borderRadius:10,alignItems:"center",shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.25,shadowRadius:3.84,elevation:5,marginBottom:15},buttonText:{color:"#fff",fontSize:16,fontWeight:"bold"},secondaryButton:{padding:10},secondaryButtonText:{color:"#FFFFFF",fontSize:16},boldText:{fontWeight:"bold",color:"#FFFFFF"},errorText:{color:"#ff6b6b",marginBottom:10,textAlign:"center"},buttonDisabled:{opacity:.7},eyeIcon:{padding:10}});function v({navigation:e}){const[t,r]=(0,u.useState)(""),[n,s]=(0,u.useState)(""),[i,l]=(0,u.useState)(""),[d,C]=(0,u.useState)(!1),[T,v]=(0,u.useState)(!1),[F,k]=(0,u.useState)(""),z=async()=>{try{const{status:e}=await b.requestForegroundPermissionsAsync();if("granted"!==e)return null;const t=await b.getCurrentPositionAsync({});return{latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy,timestamp:(new Date).toISOString()}}catch(F){return console.error("Location error:",F),null}},B=async()=>({brand:j.brand||"unknown",modelName:j.modelName||"unknown",osName:j.osName||"web",osVersion:j.osVersion||p.default.Version,platform:"web"});return(0,S.jsx)(y.default,{style:I.safeArea,children:(0,S.jsx)(h.default,{source:a(9976),style:I.container,resizeMode:"cover",defaultSource:a(9976),children:(0,S.jsxs)(o.default,{style:I.overlay,children:[(0,S.jsx)(f.default,{style:I.appName,children:"Vault"}),(0,S.jsx)(f.default,{style:I.title,children:"Create Account"}),(0,S.jsxs)(o.default,{style:I.inputContainer,children:[(0,S.jsx)(x.default,{name:"person-outline",size:24,color:"#666",style:I.inputIcon}),(0,S.jsx)(g.default,{style:I.input,placeholder:"Username",value:t,onChangeText:r,autoCapitalize:"none"})]}),(0,S.jsxs)(o.default,{style:I.inputContainer,children:[(0,S.jsx)(x.default,{name:"mail-outline",size:24,color:"#666",style:I.inputIcon}),(0,S.jsx)(g.default,{style:I.input,placeholder:"Email",value:n,onChangeText:s,autoCapitalize:"none",keyboardType:"email-address"})]}),(0,S.jsxs)(o.default,{style:I.inputContainer,children:[(0,S.jsx)(x.default,{name:"lock-closed-outline",size:24,color:"#666",style:I.inputIcon}),(0,S.jsx)(g.default,{style:I.input,placeholder:"Password",value:i,onChangeText:l,secureTextEntry:!d}),(0,S.jsx)(m.default,{style:I.eyeIcon,onPress:()=>C(!d),children:(0,S.jsx)(x.default,{name:d?"eye-off":"eye",size:24,color:"#666"})})]}),F?(0,S.jsx)(f.default,{style:I.errorText,children:F}):null,(0,S.jsx)(m.default,{style:[I.button,T&&I.buttonDisabled],onPress:async()=>{if(t.trim()&&n.trim()&&i.trim())try{v(!0),k("");const e=(await(0,c.createUserWithEmailAndPassword)($,n,i)).user,[a,r]=await Promise.all([z(),B()]);if(await(0,c.updateProfile)(e,{displayName:t}),await(0,w.setDoc)((0,w.doc)(H,"users",e.uid),{displayName:t,email:n,createdAt:(0,w.serverTimestamp)(),lastLogin:(0,w.serverTimestamp)(),lastSeen:(0,w.serverTimestamp)(),registrationLocation:a||{latitude:0,longitude:0},location:a||{latitude:0,longitude:0},deviceInfo:r}),a){const t=(new Date).toISOString();await(0,w.setDoc)((0,w.doc)(H,`users/${e.uid}/locationHistory/${t}`),Object.assign({},a,{type:"registration",timestamp:(0,w.serverTimestamp)()}))}}catch(F){let t="An error occurred during sign up";"auth/email-already-in-use"===F.code?t="This email is already registered":"auth/invalid-email"===F.code?t="Invalid email address":"auth/weak-password"===F.code&&(t="Password should be at least 6 characters"),k(t)}finally{v(!1)}else k("All fields are required")},disabled:T,children:(0,S.jsx)(f.default,{style:I.buttonText,children:T?"Creating Account...":"Sign Up"})}),(0,S.jsx)(m.default,{style:I.secondaryButton,onPress:()=>e.navigate("Login"),children:(0,S.jsxs)(f.default,{style:I.secondaryButtonText,children:["Already have an account? ",(0,S.jsx)(f.default,{style:I.boldText,children:"Login"})]})})]})})})}const I=n.default.create({safeArea:{flex:1,backgroundColor:"#000"},container:{flex:1,width:"100%",height:"100%",backgroundColor:"#1a1a1a"},overlay:{flex:1,backgroundColor:"rgba(0, 0, 0, 0.3)",alignItems:"center",justifyContent:"center",padding:20},appName:{fontSize:42,fontWeight:"bold",color:"#FFFFFF",marginBottom:10,letterSpacing:2},title:{fontSize:24,fontWeight:"600",color:"#FFFFFF",marginBottom:40},inputContainer:{width:"100%",flexDirection:"row",alignItems:"center",borderWidth:1,borderColor:"#ddd",borderRadius:10,marginBottom:15,backgroundColor:"#fff"},input:{flex:1,height:50,paddingHorizontal:15,fontSize:16},inputIcon:{paddingLeft:15},button:{backgroundColor:"#333",width:"100%",padding:15,borderRadius:10,alignItems:"center",shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.25,shadowRadius:3.84,elevation:5,marginBottom:15},buttonText:{color:"#fff",fontSize:16,fontWeight:"bold"},secondaryButton:{padding:10},secondaryButtonText:{color:"#FFFFFF",fontSize:16},boldText:{fontWeight:"bold",color:"#FFFFFF"},errorText:{color:"#ff6b6b",marginBottom:10,textAlign:"center"},buttonDisabled:{opacity:.7},eyeIcon:{padding:10}});var F=a(932),k=a(1690),z=a(4307),B=a(5163);function D({navigation:e}){const{user:t}=(0,u.useContext)(U),[r,n]=(0,u.useState)(""),[s,i]=(0,u.useState)({friends:[],newUsers:[]}),[l,d]=(0,u.useState)([]),[y,p]=(0,u.useState)(!1),j=(0,w.getFirestore)();(0,u.useEffect)((()=>{if(!t)return;let e;return(async()=>{try{const{status:a}=await b.requestForegroundPermissionsAsync();if("granted"!==a)return void console.log("Location permission denied");e=await b.watchPositionAsync({accuracy:B.LocationAccuracy.Balanced,timeInterval:5e3,distanceInterval:10},(async e=>{const a={latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,timestamp:(new Date).toISOString()};try{await(0,w.setDoc)((0,w.doc)(j,"users",t.uid),{location:a,lastSeen:(0,w.serverTimestamp)()},{merge:!0});const e=(new Date).toISOString();await(0,w.setDoc)((0,w.doc)(j,`users/${t.uid}/locationHistory/${e}`),Object.assign({},a,{type:"update",timestamp:(0,w.serverTimestamp)()}))}catch(r){console.error("Error updating location:",r)}}))}catch(a){console.error("Error starting location tracking:",a)}})(),()=>{e&&e.remove()}}),[t]);const C=e=>{if(!e)return"";const t=(new Date).getTime()-e.getTime(),a=Math.floor(t/6e4),r=Math.floor(a/60),n=Math.floor(r/24);return a<1?"Just now":a<60?`${a}m ago`:r<24?`${r}h ago`:n<7?`${n}d ago`:e.toLocaleDateString()};(0,u.useEffect)((()=>{if(!t)return;const e=(0,w.collection)(j,`users/${t.uid}/friends`),a=(0,w.onSnapshot)(e,(async e=>{const a=[];for(const r of e.docs){const e=r.data(),n=await(0,w.getDocs)((0,w.query)((0,w.collection)(j,"users"),(0,w.where)("uid","==",e.uid))),o=n.docs[0]?.data()||{},s=[t.uid,e.uid].sort().join("_"),i=(0,w.collection)(j,`chats/${s}/messages`),l=(0,w.query)(i,(0,w.orderBy)("timestamp","desc"),(0,w.limit)(1)),d=await(0,w.getDocs)(l),c=d.empty?null:d.docs[0].data(),u=(new Date).getTime()-(o.lastSeen?.toDate().getTime()||0)<12e4;a.push(Object.assign({id:r.id},e,{lastMessage:c,online:u,lastSeen:o.lastSeen?.toDate()||null}))}d(a)}));return()=>a()}),[t]);const T=async e=>{if(!y)try{p(!0);const a=await(async e=>{try{const t=await(0,w.getDocs)((0,w.query)((0,w.collection)(j,"users"),(0,w.where)("uid","==",e)));if(t.empty)throw new Error("User not found");return t.docs[0].data()}catch(t){throw console.error("Error verifying friend:",t),t}})(e.id);if(!a)throw new Error("User not found");if(!(await(0,w.getDocs)((0,w.query)((0,w.collection)(j,`users/${t.uid}/friends`),(0,w.where)("uid","==",e.id)))).empty)return void k.default.alert("Info","You are already friends with this user");const r=(0,w.writeBatch)(j),o=(0,w.doc)(j,`users/${t.uid}/friends/${e.id}`);r.set(o,{uid:e.id,displayName:a.displayName,timestamp:(0,w.serverTimestamp)()});const s=(0,w.doc)(j,`users/${e.id}/friends/${t.uid}`);r.set(s,{uid:t.uid,displayName:t.displayName,timestamp:(0,w.serverTimestamp)()});const l=[t.uid,e.id].sort().join("_"),d=(0,w.doc)(j,`chats/${l}`);r.set(d,{participants:[t.uid,e.id],created:(0,w.serverTimestamp)()}),await r.commit(),n(""),i({friends:[],newUsers:[]}),k.default.alert("Success","Friend added successfully")}catch(a){console.error("Error adding friend:",a);let e="Failed to add friend. Please try again.";"User not found"===a.message&&(e="User not found. They may have deleted their account."),k.default.alert("Error",e)}finally{p(!1)}},v=({item:t})=>(0,S.jsxs)(m.default,{style:O.friendItem,onPress:()=>e.navigate("Chat",{friendId:t.uid,friendName:t.displayName}),children:[(0,S.jsxs)(o.default,{style:O.avatarWrapper,children:[(0,S.jsx)(o.default,{style:O.avatarContainer,children:(0,S.jsx)(f.default,{style:O.avatarText,children:t.displayName[0].toUpperCase()})}),t.online&&(0,S.jsx)(o.default,{style:O.onlineIndicator})]}),(0,S.jsxs)(o.default,{style:O.friendInfo,children:[(0,S.jsxs)(o.default,{style:O.friendNameContainer,children:[(0,S.jsx)(f.default,{style:O.friendName,children:t.displayName}),(0,S.jsx)(f.default,{style:[O.statusText,t.online?O.onlineText:O.offlineText],children:t.online?"Online":t.lastSeen?C(t.lastSeen):"Offline"})]}),t.lastMessage&&(0,S.jsxs)(o.default,{style:O.lastMessageContainer,children:[(0,S.jsx)(f.default,{style:O.lastMessage,numberOfLines:1,children:t.lastMessage.text}),t.lastMessage.timestamp&&(0,S.jsxs)(f.default,{style:O.messageTime,children:["\xb7 ",new Date(t.lastMessage.timestamp.toDate()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]})]});return(0,S.jsx)(h.default,{source:a(9976),style:O.container,resizeMode:"stretch",children:(0,S.jsxs)(o.default,{style:O.overlay,children:[(0,S.jsxs)(o.default,{style:O.header,children:[(0,S.jsxs)(o.default,{style:O.headerTop,children:[(0,S.jsx)(f.default,{style:O.headerTitle,children:"Chats"}),(0,S.jsx)(m.default,{style:O.signOutButton,onPress:async()=>{try{await(0,c.signOut)($)}catch(e){console.error("Error signing out:",e),k.default.alert("Error","Failed to sign out")}},children:(0,S.jsx)(x.default,{name:"log-out-outline",size:24,color:"#fff"})})]}),(0,S.jsx)(o.default,{style:O.searchContainer,children:(0,S.jsxs)(o.default,{style:O.searchInputContainer,children:[(0,S.jsx)(x.default,{name:"search",size:20,color:"#666",style:O.searchIcon}),(0,S.jsx)(g.default,{style:O.searchInput,placeholder:"Search for user",value:r,onChangeText:async e=>{if(n(e),e.trim())try{const a=e.toLowerCase().trim(),r=l.filter((e=>e.displayName.toLowerCase().includes(a))),n=(0,w.collection)(j,"users"),o=await(0,w.getDocs)(n),s=[];o.forEach((e=>{const r=e.data();e.id!==t.uid&&!l.some((t=>t.uid===e.id))&&r.displayName&&r.displayName.toLowerCase().includes(a)&&s.push(Object.assign({id:e.id},r))})),i({friends:r,newUsers:s})}catch(a){console.error("Search error:",a),k.default.alert("Error","Failed to search for users")}else i({friends:[],newUsers:[]})},placeholderTextColor:"#666"}),r?(0,S.jsx)(m.default,{style:O.clearButton,onPress:()=>{n(""),i({friends:[],newUsers:[]})},children:(0,S.jsx)(x.default,{name:"close-circle",size:20,color:"#666"})}):null]})})]}),r?(()=>{if(!r)return null;const{friends:e,newUsers:t}=s;return(0,S.jsx)(o.default,{style:O.searchResultsContainer,children:(0,S.jsxs)(z.default,{style:O.searchScrollView,children:[e.length>0&&(0,S.jsxs)(o.default,{style:O.searchSection,children:[(0,S.jsxs)(o.default,{style:O.sectionHeader,children:[(0,S.jsx)(x.default,{name:"people",size:20,color:"#fff"}),(0,S.jsx)(f.default,{style:O.searchSectionTitle,children:"Your Friends"})]}),e.map((e=>(0,S.jsx)(o.default,{style:O.searchItemContainer,children:v({item:e})},e.id)))]}),t.length>0&&(0,S.jsxs)(o.default,{style:O.searchSection,children:[(0,S.jsxs)(o.default,{style:O.sectionHeader,children:[(0,S.jsx)(x.default,{name:"person-add",size:20,color:"#fff"}),(0,S.jsx)(f.default,{style:O.searchSectionTitle,children:"Add New Friends"})]}),t.map((e=>(0,S.jsx)(o.default,{style:O.searchItemContainer,children:(0,S.jsxs)(m.default,{style:O.searchResultItem,onPress:()=>T(e),disabled:y,children:[(0,S.jsx)(o.default,{style:O.avatarContainer,children:(0,S.jsx)(f.default,{style:O.avatarText,children:e.displayName[0].toUpperCase()})}),(0,S.jsx)(f.default,{style:O.friendName,children:e.displayName}),(0,S.jsx)(m.default,{style:[O.addButton,y&&O.addButtonDisabled],onPress:()=>T(e),disabled:y,children:(0,S.jsx)(f.default,{style:[O.addButtonText,y&&O.addButtonTextDisabled],children:y?"Adding...":"Add"})})]})},e.id)))]}),0===e.length&&0===t.length&&(0,S.jsxs)(o.default,{style:O.noResultsContainer,children:[(0,S.jsx)(x.default,{name:"search",size:40,color:"#fff",style:O.noResultsIcon}),(0,S.jsx)(f.default,{style:O.noResultsText,children:"No users found"})]})]})})})():(0,S.jsx)(F.default,{data:l,renderItem:v,keyExtractor:e=>e.id,style:O.list})]})})}const O=n.default.create({container:{flex:1,width:"100%",height:"100%"},overlay:{flex:1,backgroundColor:"rgba(0, 0, 0, 0.3)"},header:{padding:16,paddingTop:50,backgroundColor:"transparent"},headerTitle:{fontSize:42,fontWeight:"bold",color:"#FFFFFF",letterSpacing:2},searchContainer:{marginTop:10,marginBottom:5,paddingHorizontal:8},searchInputContainer:{flexDirection:"row",alignItems:"center",backgroundColor:"#fff",borderRadius:10,paddingHorizontal:10},searchIcon:{marginRight:8},searchInput:{flex:1,paddingVertical:8,fontSize:16,color:"#333"},friendItem:{padding:12,backgroundColor:"rgba(255, 255, 255, 0.9)",flexDirection:"row",alignItems:"center",borderBottomWidth:1,borderBottomColor:"rgba(238, 238, 238, 0.5)",marginHorizontal:10,marginVertical:5,borderRadius:10},avatarContainer:{width:50,height:50,borderRadius:25,backgroundColor:"#333",justifyContent:"center",alignItems:"center",marginRight:12},avatarText:{color:"#fff",fontSize:20,fontWeight:"bold"},friendInfo:{flex:1},friendName:{fontSize:16,fontWeight:"600",marginBottom:4},lastMessageContainer:{flexDirection:"row",alignItems:"center"},lastMessage:{fontSize:14,color:"#666",flex:1},messageTime:{fontSize:12,color:"#666",marginLeft:4},searchResultItem:{padding:12,backgroundColor:"rgba(255, 255, 255, 0.9)",flexDirection:"row",alignItems:"center",borderRadius:10},addButton:{backgroundColor:"#333",paddingHorizontal:15,paddingVertical:6,borderRadius:10,marginLeft:"auto",shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.25,shadowRadius:3.84,elevation:5},addButtonDisabled:{backgroundColor:"#999"},addButtonText:{color:"#fff",fontWeight:"600"},addButtonTextDisabled:{color:"#ccc"},headerTop:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:"100%"},signOutButton:{padding:8,borderRadius:20,backgroundColor:"rgba(255, 255, 255, 0.2)"},list:{flex:1,width:"100%"},avatarWrapper:{position:"relative",marginRight:12},onlineIndicator:{position:"absolute",bottom:0,right:0,width:12,height:12,borderRadius:6,backgroundColor:"#4CAF50",borderWidth:2,borderColor:"#fff"},friendNameContainer:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginBottom:4},statusText:{fontSize:12,marginLeft:8},onlineText:{color:"#4CAF50"},offlineText:{color:"#666"},searchResultsContainer:{flex:1},searchScrollView:{flex:1},searchSection:{marginBottom:15,backgroundColor:"rgba(0, 0, 0, 0.2)",borderRadius:15,padding:10,marginHorizontal:10},sectionHeader:{flexDirection:"row",alignItems:"center",marginBottom:10,paddingHorizontal:5},searchSectionTitle:{fontSize:16,fontWeight:"600",color:"#fff",marginLeft:8},searchItemContainer:{marginBottom:8},searchInputContainer:{flexDirection:"row",alignItems:"center",backgroundColor:"#fff",borderRadius:10,paddingHorizontal:10},searchIcon:{marginRight:8},searchInput:{flex:1,paddingVertical:8,fontSize:16,color:"#333"},clearButton:{padding:4},noResultsContainer:{flex:1,justifyContent:"center",alignItems:"center",paddingTop:50},noResultsIcon:{marginBottom:10,opacity:.7},noResultsText:{color:"#fff",fontSize:16,opacity:.7}});var R=a(4767),N=a(484),L=a(3303),P=a(9050),A=a(9685);function E({route:e,navigation:t}){const{friendId:r,friendName:n}=e.params,{user:s}=(0,u.useContext)(U),[i,l]=(0,u.useState)(""),[d,c]=(0,u.useState)([]),[y,p]=(0,u.useState)({online:!1,lastSeen:null}),b=(0,w.getFirestore)(),j=(0,A.getStorage)();(0,u.useEffect)((()=>{if(!s||!r)return;const e=(0,w.doc)(b,"users",r),t=(0,w.onSnapshot)(e,(e=>{if(e.exists()){const t=e.data(),a=(new Date).getTime(),r=t.lastSeen?.toDate().getTime()||0;p({online:a-r<12e4,lastSeen:t.lastSeen?.toDate()||null})}}));return()=>t()}),[r]);(0,u.useEffect)((()=>{if(!s||!r)return;const e=[s.uid,r].sort().join("_"),t=(0,w.collection)(b,`chats/${e}/messages`),a=(0,w.query)(t,(0,w.orderBy)("timestamp","asc")),n=(0,w.onSnapshot)(a,(e=>{const t=[];e.forEach((e=>{t.push(Object.assign({id:e.id},e.data(),{sender:e.data().senderId===s.uid?"me":"friend"}))})),c(t)}));return()=>n()}),[s,r]);const C=async e=>{try{const t=await fetch(e),a=await t.blob(),n=`${Date.now()}_${Math.random().toString(36).substring(7)}`,o=(0,A.ref)(j,`chat-media/${n}`);await(0,A.uploadBytes)(o,a);const i=await(0,A.getDownloadURL)(o),l=[s.uid,r].sort().join("_"),d=(0,w.collection)(b,`chats/${l}/messages`);await(0,w.addDoc)(d,{mediaUrl:i,senderId:s.uid,timestamp:(0,w.serverTimestamp)(),type:"image"})}catch(t){console.error("Error uploading media:",t),k.default.alert("Error","Failed to upload media")}};return(0,S.jsx)(R.default,{behavior:"height",style:M.container,children:(0,S.jsx)(h.default,{source:a(9976),style:M.backgroundImage,resizeMode:"stretch",children:(0,S.jsxs)(o.default,{style:M.overlay,children:[(0,S.jsxs)(o.default,{style:M.header,children:[(0,S.jsx)(m.default,{style:M.backButton,onPress:()=>t.goBack(),children:(0,S.jsx)(x.default,{name:"arrow-back",size:24,color:"#fff"})}),(0,S.jsxs)(o.default,{style:M.profileContainer,children:[(0,S.jsx)(o.default,{style:M.avatarContainer,children:(0,S.jsx)(f.default,{style:M.avatarText,children:n[0].toUpperCase()})}),(0,S.jsxs)(o.default,{style:M.headerInfo,children:[(0,S.jsx)(f.default,{style:M.headerTitle,children:n}),(0,S.jsx)(f.default,{style:[M.statusText,y.online?M.onlineText:M.offlineText],children:y.online?"Online":y.lastSeen?`Last seen ${(e=>{if(!e)return"";const t=(new Date).getTime()-e.getTime(),a=Math.floor(t/6e4),r=Math.floor(a/60),n=Math.floor(r/24);return a<1?"Just now":a<60?`${a}m ago`:r<24?`${r}h ago`:n<7?`${n}d ago`:e.toLocaleDateString()})(y.lastSeen)}`:"Offline"})]})]})]}),(0,S.jsx)(F.default,{data:d,renderItem:({item:e})=>(0,S.jsxs)(o.default,{style:[M.messageBubble,"me"===e.sender?M.myMessage:M.friendMessage],children:["image"===e.type?(0,S.jsx)(N.default,{source:{uri:e.mediaUrl},style:M.messageImage,resizeMode:"cover"}):(0,S.jsx)(f.default,{style:[M.messageText,"me"===e.sender?M.myMessageText:M.friendMessageText],children:e.text}),e.timestamp&&(0,S.jsx)(f.default,{style:M.timestamp,children:new Date(e.timestamp.toDate()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),keyExtractor:e=>e.id,contentContainerStyle:M.messageList,inverted:!1}),(0,S.jsxs)(o.default,{style:M.inputContainer,children:[(0,S.jsx)(m.default,{style:M.attachButton,onPress:async()=>{try{const{status:e}=await L.requestMediaLibraryPermissionsAsync();if("granted"!==e)return void k.default.alert("Sorry, we need camera roll permissions to make this work!");const t=await L.launchImageLibraryAsync({mediaTypes:P.MediaTypeOptions.Images,quality:1,allowsEditing:!0});!t.canceled&&t.assets&&t.assets.length>0&&await C(t.assets[0].uri)}catch(e){k.default.alert("Error","Failed to pick image")}},children:(0,S.jsx)(x.default,{name:"attach",size:24,color:"#333"})}),(0,S.jsx)(g.default,{style:M.input,value:i,onChangeText:l,placeholder:"Type a message...",multiline:!0,maxLength:500}),(0,S.jsx)(m.default,{style:[M.sendButton,!i.trim()&&M.sendButtonDisabled],onPress:async()=>{if(i.trim())try{const e=[s.uid,r].sort().join("_"),t=(0,w.collection)(b,`chats/${e}/messages`);await(0,w.addDoc)(t,{text:i,senderId:s.uid,timestamp:(0,w.serverTimestamp)(),type:"text"}),l("")}catch(e){console.error("Error sending message:",e),k.default.alert("Error","Failed to send message")}},disabled:!i.trim(),children:(0,S.jsx)(x.default,{name:"send",size:24,color:i.trim()?"#fff":"#999"})})]})]})})})}const M=n.default.create({container:{flex:1,backgroundColor:"#000"},backgroundImage:{flex:1,width:"100%",height:"100%"},overlay:{flex:1,backgroundColor:"rgba(0, 0, 0, 0.3)"},header:{flexDirection:"row",alignItems:"center",padding:16,backgroundColor:"rgba(0, 0, 0, 0.3)",paddingTop:16},backButton:{padding:8},profileContainer:{flexDirection:"row",alignItems:"center",flex:1,marginLeft:8},avatarContainer:{width:40,height:40,borderRadius:20,backgroundColor:"#333",justifyContent:"center",alignItems:"center",marginRight:12},avatarText:{color:"#fff",fontSize:18,fontWeight:"bold"},headerTitle:{fontSize:18,fontWeight:"bold",color:"#fff"},headerInfo:{flex:1,justifyContent:"center"},statusText:{fontSize:12,marginTop:2,color:"#fff"},onlineText:{color:"#4CAF50"},offlineText:{color:"#bbb"},messageList:{padding:16},messageBubble:{maxWidth:"80%",padding:12,borderRadius:16,marginBottom:8},myMessage:{backgroundColor:"#333",alignSelf:"flex-end",borderBottomRightRadius:4},friendMessage:{backgroundColor:"rgba(255, 255, 255, 0.9)",alignSelf:"flex-start",borderBottomLeftRadius:4},messageText:{fontSize:16},myMessageText:{color:"#fff"},friendMessageText:{color:"#000"},messageImage:{width:200,height:200,borderRadius:8},timestamp:{fontSize:12,color:"#666",alignSelf:"flex-end",marginTop:4},inputContainer:{flexDirection:"row",padding:8,backgroundColor:"rgba(255, 255, 255, 0.9)",alignItems:"center",margin:8,borderRadius:24},attachButton:{padding:8},input:{flex:1,backgroundColor:"transparent",paddingHorizontal:16,paddingVertical:8,maxHeight:100,fontSize:16},sendButton:{backgroundColor:"#333",width:40,height:40,borderRadius:20,justifyContent:"center",alignItems:"center"},sendButtonDisabled:{backgroundColor:"#ccc"}}),W=(0,d.initializeApp)({apiKey:"AIzaSyCSqR2bBqvxsOHdANWH10UCWtR15tukKBs",authDomain:"vaultrn.firebaseapp.com",projectId:"vaultrn",storageBucket:"vaultrn.firebasestorage.app",messagingSenderId:"962260241751",appId:"1:962260241751:web:7e6ac40a01c2f518768212",measurementId:"G-EWM0JESQZW"}),$=(0,c.getAuth)(W),U=(0,u.createContext)(),H=(0,w.getFirestore)(W),q=(0,l.default)();function V(){const[e,t]=(0,u.useState)(null),[a,n]=(0,u.useState)(!0);return(0,u.useEffect)((()=>{const e=(0,c.onAuthStateChanged)($,(async e=>{e&&await(0,w.setDoc)((0,w.doc)(H,"users",e.uid),{displayName:e.displayName,email:e.email,lastSeen:(new Date).toISOString()},{merge:!0}),t(e),n(!1)}));return()=>e()}),[]),a?(0,S.jsx)(o.default,{style:_.loadingContainer,children:(0,S.jsx)(s.default,{size:"large",color:"#333"})}):(0,S.jsxs)(i.default,{children:[(0,S.jsx)(U.Provider,{value:{user:e,setUser:t},children:(0,S.jsx)(q.Navigator,{initialRouteName:e?"FriendsList":"Login",screenOptions:{headerShown:!1,animation:"fade"},children:e?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(q.Screen,{name:"FriendsList",component:D}),(0,S.jsx)(q.Screen,{name:"Chat",component:E})]}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(q.Screen,{name:"Login",component:C}),(0,S.jsx)(q.Screen,{name:"SignUp",component:v})]})})}),(0,S.jsx)(r.StatusBar,{style:"light"})]})}const _=n.default.create({container:{flex:1,backgroundColor:"#1a1a1a"},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"#1a1a1a"}})},9976:(e,t,a)=>{e.exports=a.p+"static/media/background4c.da18a95efc4817724232.jpg"}},t={};function a(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,a),o.exports}a.m=e,a.amdO={},(()=>{var e=[];a.O=(t,r,n,o)=>{if(!r){var s=1/0;for(c=0;c<e.length;c++){for(var[r,n,o]=e[c],i=!0,l=0;l<r.length;l++)(!1&o||s>=o)&&Object.keys(a.O).every((e=>a.O[e](r[l])))?r.splice(l--,1):(i=!1,o<s&&(s=o));if(i){e.splice(c--,1);var d=n();void 0!==d&&(t=d)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[r,n,o]}})(),a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="/",(()=>{var e={792:0};a.O.j=t=>0===e[t];var t=(t,r)=>{var n,o,[s,i,l]=r,d=0;if(s.some((t=>0!==e[t]))){for(n in i)a.o(i,n)&&(a.m[n]=i[n]);if(l)var c=l(a)}for(t&&t(r);d<s.length;d++)o=s[d],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(c)},r=self.webpackChunkweb=self.webpackChunkweb||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var r=a.O(void 0,[936],(()=>a(4424)));r=a.O(r)})();
//# sourceMappingURL=main.b89bea14.js.map